<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/gh/ehsann95/noqod-gateway/index.js"></script>
    <title>Callback</title>
  </head>
  <body>
    <div>
      <button
        style="
          background-color: #388fe9;
          color: #fff;
          border: none;
          padding: 0.7rem;
          font-size: 1.2rem;
          outline: none;
          letter-spacing: 0.09rem;
        "
        id="btn_chkout"
      >
        Proceed
      </button>
    </div>
    <div id="orderDetails"></div>

    <script>
      let params = {};

      // ***************** GATEWAY *******************
      let checkoutBtn = document.getElementById("btn_chkout");

      checkoutBtn.addEventListener("click", handleChekout);

      let noqod = npg("7006911868");

      function handleChekout() {
        noqod.sendRequest(
          "200",
          "19012138137211",
          "https://eager-villani-4e5c4e.netlify.app/"
        );
      }

      // *********** After Payment - CALLBACK ****************
      window.addEventListener("DOMContentLoaded", (e) => {
        params = getParams("transaction_id", "order_id", "payment_capture");
        if (params?.transactionId) {
          document.getElementById("orderDetails").innerHTML = `
          <div class="text-center">
            <h4>Order ID: ${params.transactionId}</h4>
            <h4>Transaction ID: ${params.orderId}</h4>
            <h5>Payment Capture: ${params.paymentCapture}</h5>
          </div>
          `;
          checkoutBtn.style.display = "none";
        }
      });

      function getParams(trans, order, payCapture) {
        var transactionId = new RegExp("[\?&]" + trans + "=([^&#]*)").exec(
          window.location.href
        );
        var orderId = new RegExp("[\?&]" + order + "=([^&#]*)").exec(
          window.location.href
        );
        var paymentCapture = new RegExp(
          "[\?&]" + payCapture + "=([^&#]*)"
        ).exec(window.location.href);

        if (transactionId && orderId) {
          return {
            transactionId: transactionId[1],
            orderId: orderId[1],
            paymentCapture: paymentCapture[1],
          };
        }
      }
    </script>
  </body>
</html>
